# vega_test_task
 - ТЗ

Порядок выполнения тестового задания

Необходимые библиотеки:

    1. python3-mapscript
    2. опционально python3-sqlalchemy
    3. опционально «любимый» лёгкий web фреймворк: flask, bottle, aiohttp, etc  

Вводные данные:

В каталоге src есть следующие файлы:
    • mapfile_web.py — минималистичный web server для рендеринга map картостиля на python3-mapscript и wsgiref
    • spb3857.json — данные для рендеринга карты в системе координат pseudo-mercator
    • spb3857.map — картостиль рендеринга в системе координат pseudo-mercator
    • spb4326.json — данные для рендеринга карты в системе координат wgs84
    • spb4326.map — картостиль рендеринга в системе координат wgs84

Каждую пару картостиль+данные можно запустить командами:
python3 mapfile_web.py spb3857.map
python3 mapfile_web.py spb4326.map

Результатом в обоих случаях будет запуск web сервера на порту 3007.

Если на той же рабочей станции в браузере выполнить запрос: 
http://localhost:3007/?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=3359332.801464934368,8381615.12248637341,3377232.975584486965,8395864.989966142923&CRS=EPSG:3857&WIDTH=1016&HEIGHT=808&LAYERS=spb&STYLES=&FORMAT=image/png

То будет получен результат в виде изображения:
![Image alt](https://https://github.com/KonstantinLjapin/vega_test_task/raw/main/exmpl_map.jpg)
Это результат рендеринга картостиля — запрос одинаков в обоих случаях и даёт одинаковый результат.

Задача:
    1. Создать систему загрузки пары картостиль.map + данные_для_рендеринга.json в таблицу sqlite DB со следующим набором полей: * 
1.1.  id(int) — id записи в БД, 
1.2.  mapname(str) — имя по которому будет срабатывать запрос из  раздела 2, 
1.3.  mapstyle(str) — поле для хранения данных файла «картостиль.map», 
1.4  gjson(str) — поле для хранения данных файла «данные_для_рендеринга.json».  
Для этой задачи можно использовать как чистый python sqlite3, так и ORM фреймворк sqlalchemy
    2. Модифицировать или полностью переписать на «любимый web фреймворк» логику работы mapfile_web.py так, чтобы при запросе вида: http://localhost:3007/<mapname>?<wms запрос из базового примера>:
2.1.  Из БД по mapname из поля gjson выгружался файл «данные_для_рендеринга.json» во временное хранилище (произвольный каталог), **
2.2.   Модифицированный web сервер получал из БД по mapname данные файла «картостиль.map» и передавал их на обработку python-mapscript (как это сделано в базовом примере см: PubMapWEB.application). ***
    3. Проверка работы производится запросом вида http://localhost:3007/<mapname>?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=3359332.801464934368,8381615.12248637341,3377232.975584486965,8395864.989966142923&CRS=EPSG:3857&WIDTH=1016&HEIGHT=808&LAYERS=spb&STYLES=&FORMAT=image/png 
в обоих случаях дающего результат как в базовом примере.  

* Система загрузки может представлять из себя:
    • консольную утилиту,
    • GUI, TUI и пр UI приложение,
    • систему  загрузки данных на web сервер по post запросу - в этом случае систему загрузки можно совместить с web сервисом рендеринга,
    • etc …

** Необходимо чтобы картостиль «увидел» выгруженный файл «данные_для_рендеринга.json» в произвольном каталоге. Для этого в файле «картостиль.map» следует заранее, до его загрузки в БД, изменить строку 27:CONNECTION "данные_для_рендеринга.json", дописав к имени файла путь к каталогу выгрузки. В результате строка   CONNECTION должна выглядеть так: "/путь/выгрузки/данные_для_рендеринга.json".
Выгружаемый из БД файл «данные_для_рендеринга.json» должен иметь то же имя что указано в  CONNECTION «картостиль.map». Для этого можно хранить имя файла (без расширения) в поле БД  mapname.

*** Допускается, как модификация базового примера mapfile_web.py, так и полное переписывание логики на выбранный web фреймворк. Во втором случае, следует учесть, что логику из PubMapWEB.application #mapserver magic, лучше оставить без изменений (если нет опыта работы с mapserver). Исключением является строка 25:request.loadParamsFromURL(env['QUERY_STRING']), где вместо env['QUERY_STRING'] следует передавать request query string вашего web фреймворка.


Результаты:

Результатом выполнения работы является создание кода, выполняющего описанный в задаче функционал.
Предоставление результатов тестового задание следует организовать в виде проекта на https://github.com или https://gitlab.com — это позволит обсуждать выполнение задания в рамках ваших проектов. Имя пользователя специалиста от предприятия oldbay (в обоих случаях).